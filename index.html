<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ï‡∏π‡πâ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
</head>
<body>
  <h1>‡∏ï‡∏π‡πâ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
  <button onclick="addLocker()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå</button>
  <div id="lockers"></div>

  <script>
    async function loadLockers() {
      const res = await fetch("/api/lockers");
      const data = await res.json();
      const div = document.getElementById("lockers");
      div.innerHTML = "";
      data.forEach(locker => {
        div.innerHTML += `
          <div>
            <b>Locker ${locker.id}</b> - ${locker.locked ? "üîí Locked" : "üîì Open"}
            <button onclick="openLocker(${locker.id})">‡πÄ‡∏õ‡∏¥‡∏î</button>
          </div>
        `;
      });
    }

    async function addLocker() {
      const password = prompt("‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå");
      await fetch("/api/lockers", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ password })
      });
      loadLockers();
    }

    async function openLocker(id) {
      const password = prompt("‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå (‡∏ñ‡πâ‡∏≤‡∏•‡∏∑‡∏°‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà)");
      const res = await fetch("/api/open", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ id, password })
      });
      const data = await res.json();
      if (data.success) {
        alert("‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå: " + JSON.stringify(data.files));
      } else {
        alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î!");
      }
    }

    loadLockers();
  </script>
</body>
</html>
